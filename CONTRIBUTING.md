# ğŸ¤ è´¡çŒ®æŒ‡å—

æ„Ÿè°¢ä½ å¯¹ Epub æ™ºèƒ½é˜…è¯»å™¨é¡¹ç›®çš„å…´è¶£ï¼æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ã€‚

## è¡Œä¸ºå‡†åˆ™

- å°Šé‡æ‰€æœ‰è´¡çŒ®è€…
- ä¿æŒå‹å–„å’Œä¸“ä¸š
- æ¥å—å»ºè®¾æ€§çš„æ‰¹è¯„
- å…³æ³¨å¯¹é¡¹ç›®æœ€æœ‰åˆ©çš„äº‹æƒ…

## å¦‚ä½•è´¡çŒ®

### æŠ¥å‘Š Bug

å¦‚æœä½ å‘ç°äº† bugï¼Œè¯·åˆ›å»ºä¸€ä¸ª Issue å¹¶åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

- **ç®€çŸ­æè¿°**ï¼šä¸€å¥è¯æè¿°é—®é¢˜
- **é‡ç°æ­¥éª¤**ï¼šè¯¦ç»†çš„é‡ç°æ­¥éª¤
- **é¢„æœŸè¡Œä¸º**ï¼šä½ æœŸæœ›å‘ç”Ÿä»€ä¹ˆ
- **å®é™…è¡Œä¸º**ï¼šå®é™…å‘ç”Ÿäº†ä»€ä¹ˆ
- **ç¯å¢ƒä¿¡æ¯**ï¼šæµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿã€Node.js ç‰ˆæœ¬ç­‰
- **æˆªå›¾**ï¼šå¦‚æœé€‚ç”¨ï¼Œæ·»åŠ æˆªå›¾

**Bug æŠ¥å‘Šæ¨¡æ¿**ï¼š

```markdown
## é—®é¢˜æè¿°
ç®€çŸ­æè¿°é—®é¢˜

## é‡ç°æ­¥éª¤
1. æ‰“å¼€åº”ç”¨
2. ç‚¹å‡» XXX
3. æ»šåŠ¨åˆ° YYY
4. çœ‹åˆ°é”™è¯¯

## é¢„æœŸè¡Œä¸º
åº”è¯¥æ˜¾ç¤º XXX

## å®é™…è¡Œä¸º
æ˜¾ç¤ºäº† YYY

## ç¯å¢ƒä¿¡æ¯
- æµè§ˆå™¨ï¼šChrome 120
- æ“ä½œç³»ç»Ÿï¼šWindows 11
- Node.jsï¼š18.0.0

## æˆªå›¾
[å¦‚æœ‰éœ€è¦]
```

### å»ºè®®æ–°åŠŸèƒ½

åˆ›å»ºä¸€ä¸ª Feature Request Issueï¼š

```markdown
## åŠŸèƒ½æè¿°
æ¸…æ™°ç®€æ´åœ°æè¿°ä½ æƒ³è¦çš„åŠŸèƒ½

## åŠ¨æœº
ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

## å»ºè®®çš„è§£å†³æ–¹æ¡ˆ
ä½ è®¤ä¸ºåº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ

## æ›¿ä»£æ–¹æ¡ˆ
è€ƒè™‘è¿‡å…¶ä»–æ–¹æ¡ˆå—ï¼Ÿ

## é¢å¤–ä¿¡æ¯
ä»»ä½•å…¶ä»–æœ‰å¸®åŠ©çš„ä¿¡æ¯
```

### æäº¤ä»£ç 

#### 1. Fork é¡¹ç›®

ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ "Fork" æŒ‰é’®

#### 2. å…‹éš†ä½ çš„ Fork

```bash
git clone https://github.com/your-username/epub-reader.git
cd epub-reader
```

#### 3. åˆ›å»ºåˆ†æ”¯

```bash
# åŠŸèƒ½åˆ†æ”¯
git checkout -b feature/amazing-feature

# ä¿®å¤åˆ†æ”¯
git checkout -b fix/bug-description

# æ–‡æ¡£åˆ†æ”¯
git checkout -b docs/update-readme
```

**åˆ†æ”¯å‘½åè§„èŒƒ**ï¼š
- `feature/` - æ–°åŠŸèƒ½
- `fix/` - Bug ä¿®å¤
- `docs/` - æ–‡æ¡£æ›´æ–°
- `style/` - ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor/` - é‡æ„
- `test/` - æµ‹è¯•ç›¸å…³
- `chore/` - æ„å»º/å·¥å…·ç›¸å…³

#### 4. å®‰è£…ä¾èµ–

```bash
npm install
```

#### 5. è¿›è¡Œä¿®æ”¹

éµå¾ªæˆ‘ä»¬çš„ç¼–ç è§„èŒƒï¼ˆè§ä¸‹æ–‡ï¼‰

#### 6. æµ‹è¯•ä½ çš„ä¿®æ”¹

```bash
# è¿è¡Œå¼€å‘æœåŠ¡å™¨
npm run dev

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check

# è¿è¡Œ linter
npm run lint

# è¿è¡Œæµ‹è¯•ï¼ˆå¦‚æœæœ‰ï¼‰
npm run test
```

#### 7. æäº¤ä¿®æ”¹

```bash
git add .
git commit -m "feat: add amazing feature"
```

**æäº¤ä¿¡æ¯è§„èŒƒï¼ˆConventional Commitsï¼‰**ï¼š

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type**ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼
- `refactor`: é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•
- `chore`: æ„å»º/å·¥å…·

**ç¤ºä¾‹**ï¼š

```bash
# ç®€å•æäº¤
git commit -m "feat: add dark mode support"

# å¸¦ä½œç”¨åŸŸ
git commit -m "fix(parser): handle malformed EPUB files"

# å¸¦è¯¦ç»†è¯´æ˜
git commit -m "feat(highlight): add color picker

- Add color picker component
- Support custom highlight colors
- Save color preferences to localStorage

Closes #123"
```

#### 8. æ¨é€åˆ°ä½ çš„ Fork

```bash
git push origin feature/amazing-feature
```

#### 9. åˆ›å»º Pull Request

1. è®¿é—®ä½ çš„ Fork é¡µé¢
2. ç‚¹å‡» "New Pull Request"
3. å¡«å†™ PR æè¿°ï¼š

```markdown
## å˜æ›´æè¿°
æ¸…æ¥šåœ°æè¿°ä½ çš„ä¿®æ”¹

## ç›¸å…³ Issue
Closes #123

## ä¿®æ”¹ç±»å‹
- [ ] Bug ä¿®å¤
- [x] æ–°åŠŸèƒ½
- [ ] é‡å¤§å˜æ›´
- [ ] æ–‡æ¡£æ›´æ–°

## æµ‹è¯•
- [x] å·²æ·»åŠ æµ‹è¯•ç”¨ä¾‹
- [x] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [x] å·²åœ¨æœ¬åœ°æµ‹è¯•

## æˆªå›¾
[å¦‚æœé€‚ç”¨]

## æ£€æŸ¥æ¸…å•
- [x] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒ
- [x] å·²æ›´æ–°æ–‡æ¡£
- [x] æ—  TypeScript é”™è¯¯
- [x] æ—  ESLint è­¦å‘Š
- [x] å·²æµ‹è¯•åœ¨å¤šä¸ªæµè§ˆå™¨
```

## ç¼–ç è§„èŒƒ

### TypeScript

```typescript
// âœ… å¥½çš„
interface User {
  id: string;
  name: string;
  email: string;
}

function getUserById(id: string): Promise<User | null> {
  // ä½¿ç”¨æ˜¾å¼è¿”å›ç±»å‹
}

// âŒ ä¸å¥½çš„
function getUser(id) { // ç¼ºå°‘ç±»å‹
  // ...
}
```

### å‘½åè§„èŒƒ

```typescript
// ç»„ä»¶ - PascalCase
export function EpubReader() {}

// å‡½æ•° - camelCase
function loadChapter() {}

// å¸¸é‡ - UPPER_SNAKE_CASE
const MAX_CACHE_SIZE = 10;

// æ¥å£/ç±»å‹ - PascalCase
interface EpubChapter {}
type HighlightColor = string;

// ç§æœ‰å±æ€§ - å‰ç¼€ä¸‹åˆ’çº¿
class Parser {
  private _cache: Map<string, string>;
}
```

### æ³¨é‡Š

```typescript
/**
 * åŠ è½½ EPUB ç« èŠ‚å†…å®¹
 * 
 * @param chapterId - ç« èŠ‚ID
 * @returns ç« èŠ‚HTMLå†…å®¹
 * @throws {Error} å¦‚æœç« èŠ‚ä¸å­˜åœ¨
 * 
 * @example
 * ```typescript
 * const content = await parser.loadChapter('chapter-1');
 * ```
 */
async loadChapter(chapterId: string): Promise<string> {
  // å®ç°
}

// å•è¡Œæ³¨é‡Šï¼šç®€çŸ­è¯´æ˜
const result = calculate(); // è®¡ç®—ç»“æœ

// å¤šè¡Œæ³¨é‡Šï¼šå¤æ‚é€»è¾‘
/*
 * è¿™é‡Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ˜¯å› ä¸ºï¼š
 * 1. æ•°æ®å·²æ’åº
 * 2. éœ€è¦ O(log n) æ—¶é—´å¤æ‚åº¦
 * 3. æ•°æ®é‡å¯èƒ½å¾ˆå¤§
 */
```

### ä»£ç ç»„ç»‡

```typescript
// 1. å¯¼å…¥ï¼ˆæŒ‰ç±»å‹åˆ†ç»„ï¼‰
// React ç›¸å…³
import { useState, useEffect } from 'react';

// ç¬¬ä¸‰æ–¹åº“
import * as zip from '@zip.js/zip.js';

// æœ¬åœ°æ¨¡å—ï¼ˆæŒ‰å±‚çº§ï¼‰
import { Parser } from './parse/Parser';
import { HighlightSystem } from './highlight/HighlightSystem';

// ç±»å‹
import type { Chapter } from './types';

// æ ·å¼
import './styles.css';

// 2. ç±»å‹å®šä¹‰
interface Props {}

// 3. å¸¸é‡
const DEFAULT_CONFIG = {};

// 4. ç»„ä»¶/ç±»
export function Component() {}

// 5. è¾…åŠ©å‡½æ•°
function helper() {}
```

### é”™è¯¯å¤„ç†

```typescript
// âœ… å¥½çš„
async function loadFile(path: string): Promise<string> {
  try {
    const content = await fetchFile(path);
    return content;
  } catch (error) {
    console.error(`Failed to load file ${path}:`, error);
    throw new Error(`File loading failed: ${path}`);
  }
}

// âŒ ä¸å¥½çš„
async function loadFile(path: string) {
  const content = await fetchFile(path); // æ²¡æœ‰é”™è¯¯å¤„ç†
  return content;
}
```

### æ€§èƒ½è€ƒè™‘

```typescript
// âœ… ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—
const sortedData = useMemo(
  () => data.sort((a, b) => a.order - b.order),
  [data]
);

// âœ… ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°
const handleClick = useCallback(() => {
  doSomething(id);
}, [id]);

// âœ… é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
const MemoizedComponent = memo(ExpensiveComponent);

// âœ… ä½¿ç”¨è™šæ‹ŸåŒ–å¤„ç†å¤§åˆ—è¡¨
<VirtualList items={largeArray} />
```

### æµ‹è¯•

```typescript
describe('EpubParser', () => {
  it('should load local file', async () => {
    const parser = new EpubParser();
    const file = new File(['content'], 'test.epub');
    
    await parser.load(file);
    
    expect(parser.getChapters()).toHaveLength(3);
  });

  it('should handle invalid file', async () => {
    const parser = new EpubParser();
    const invalidFile = new File(['invalid'], 'test.txt');
    
    await expect(parser.load(invalidFile)).rejects.toThrow();
  });
});
```

## å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆçƒ­é‡è½½ï¼‰
npm run dev

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œç±»å‹æ£€æŸ¥ï¼ˆç›‘å¬æ¨¡å¼ï¼‰
npm run type-check -- --watch
```

### ä»£ç è´¨é‡

```bash
# è¿è¡Œæ‰€æœ‰æ£€æŸ¥
npm run lint        # ESLint
npm run type-check  # TypeScript
npm run format      # Prettier

# è‡ªåŠ¨ä¿®å¤
npm run lint -- --fix
npm run format -- --write
```

### æäº¤å‰æ£€æŸ¥

```bash
# å®Œæ•´æ£€æŸ¥æµç¨‹
npm run lint && npm run type-check && npm run test
```

### Git Hooksï¼ˆæ¨èï¼‰

å®‰è£… husky å’Œ lint-stagedï¼š

```bash
npm install -D husky lint-staged

# åˆå§‹åŒ– husky
npx husky init

# æ·»åŠ  pre-commit hook
echo "npx lint-staged" > .husky/pre-commit
```

é…ç½® `package.json`ï¼š

```json
{
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{css,md}": [
      "prettier --write"
    ]
  }
}
```

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ parse/          # EPUB è§£æ
â”‚   â””â”€â”€ Parse.tsx
â”œâ”€â”€ highlight/      # åˆ’çº¿ç³»ç»Ÿ
â”‚   â”œâ”€â”€ HighlightSystem.ts
â”‚   â””â”€â”€ VirtualHighlightRenderer.ts
â”œâ”€â”€ ai/             # AI åŠŸèƒ½
â”‚   â””â”€â”€ AIAssistant.ts
â”œâ”€â”€ mcp/            # MCP é›†æˆ
â”‚   â””â”€â”€ MCPClient.ts
â”œâ”€â”€ storage/        # å­˜å‚¨ç®¡ç†
â”‚   â””â”€â”€ StorageManager.ts
â”œâ”€â”€ config/         # é…ç½®
â”‚   â””â”€â”€ dashscope.ts
â””â”€â”€ components/     # UI ç»„ä»¶
    â”œâ”€â”€ read/
    â””â”€â”€ shared/
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ AI åŠŸèƒ½ï¼Ÿ

ç¼–è¾‘ `src/ai/AIAssistant.ts`ï¼Œæ·»åŠ æ–°çš„å¤„ç†é“¾ï¼š

```typescript
private buildMyChain(): RunnableSequence {
  const template = PromptTemplate.fromTemplate(`...`);
  return RunnableSequence.from([
    template,
    this.llm,
    new StringOutputParser(),
  ]);
}
```

### Q: å¦‚ä½•æ”¯æŒæ–°çš„å¯¼å‡ºæ ¼å¼ï¼Ÿ

ç¼–è¾‘ `src/storage/StorageManager.ts`ï¼Œæ·»åŠ æ–°çš„å¯¼å‡ºæ–¹æ³•ï¼š

```typescript
async exportToMyFormat(bookId: string): Promise<string> {
  const data = await this.getBookData(bookId);
  return convertToMyFormat(data);
}
```

### Q: å¦‚ä½•ä¼˜åŒ–å¤§æ–‡ä»¶æ€§èƒ½ï¼Ÿ

- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå·²å®ç°ï¼‰
- å¢åŠ ç¼“å­˜å¤§å°
- å¯ç”¨é¢„åŠ è½½
- ä½¿ç”¨ Web Workerï¼ˆè®¡åˆ’ä¸­ï¼‰

## å‘å¸ƒæµç¨‹

1. æ›´æ–°ç‰ˆæœ¬å·ï¼š`npm version [patch|minor|major]`
2. æ›´æ–° CHANGELOG.md
3. æäº¤ï¼š`git commit -m "chore: release v1.x.x"`
4. æ‰“æ ‡ç­¾ï¼š`git tag v1.x.x`
5. æ¨é€ï¼š`git push && git push --tags`

## è”ç³»æ–¹å¼

- GitHub Issues: [é¡¹ç›® Issues](https://github.com/yourusername/epub-reader/issues)
- Discussions: [GitHub Discussions](https://github.com/yourusername/epub-reader/discussions)
- Email: your.email@example.com

## è®¸å¯è¯

é€šè¿‡è´¡çŒ®ä»£ç ï¼Œä½ åŒæ„ä½ çš„è´¡çŒ®å°†åœ¨ MIT è®¸å¯è¯ä¸‹å‘å¸ƒã€‚

---

æ„Ÿè°¢ä½ çš„è´¡çŒ®ï¼ â¤ï¸

